<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giriş Yap - HukukSis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* --- SENİN GÖNDERDİĞİN TASARIMIN CSS'E ÇEVRİLMİŞ HALİ --- */
        
        /* Bildirimlerin toplanacağı alan (Sağ üst köşe) */
        .xd-container {
            width: 350px;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .xd-message {
            display: flex;
            flex-wrap: nowrap;
            width: 100%;
            min-height: 60px;
            background: #FFF;
            border: 1px solid #455870;
            box-shadow: 2px 4px 10px rgba(0,0,0,0.1);
            position: relative;
            animation: slideIn 0.5s ease;
            border-radius: 4px;
            overflow: hidden;
        }

        .xd-message-icon {
            background: #455870;
            display: flex;
            flex: 0 0 50px; /* Sabit genişlik */
            justify-content: center;
            align-items: center;
            color: #FFF;
            font-size: 1.4rem;
        }

        .xd-message-content {
            flex: 1;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #333;
            font-weight: 500;
        }

        .xd-message-close {
            color: #455870;
            display: flex;
            flex: 0 0 40px;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }
        
        .xd-message-close:hover {
            background-color: rgba(0,0,0,0.05);
        }

        /* HATA (Danger) TEMA */
        .msg-danger {
            border: 1px solid #b05150;
        }
        .msg-danger .xd-message-icon {
            background: #b05150;
        }
        .msg-danger .xd-message-content {
            color: #b05150;
        }
        .msg-danger .xd-message-close {
            color: #b05150;
        }

        /* BAŞARI (Success) TEMA */
        .msg-success {
            border: 1px solid #47ae74;
        }
        .msg-success .xd-message-icon {
            background: #47ae74;
        }
        .msg-success .xd-message-content {
            color: #2e7d32; /* Yazı biraz daha koyu olsun okunurluk için */
        }
        .msg-success .xd-message-close {
            color: #47ae74;
        }

        /* UYARI (Warning) TEMA */
        .msg-warning {
            border: 1px solid #ef974b;
        }
        .msg-warning .xd-message-icon {
            background: #ef974b;
        }
        .msg-warning .xd-message-content {
            color: #e67e22;
        }
        .msg-warning .xd-message-close {
            color: #ef974b;
        }

        /* Animasyonlar */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .xd-hide {
            animation: hideMsgAlert 0.5s forwards;
        }

        @keyframes hideMsgAlert {
            0% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(100%); }
        }

        /* --- LOGİN SAYFASI STİLLERİ --- */
        .card-login { border: none; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); overflow: hidden; width: 400px; }
        .card-header { background-color: #2c3e50; color: white; text-align: center; padding: 40px 30px 30px; border-bottom: none; }
        .btn-custom { background-color: #1abc9c; border: none; padding: 12px; font-size: 1.1em; font-weight: 600; border-radius: 10px; transition: 0.3s; color: white; width: 100%; }
        .btn-custom:hover { background-color: #16a085; color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(26, 188, 156, 0.4); }
        .form-floating > label { color: #999; }
        .form-floating > .form-control:focus ~ label { color: #1abc9c; }
        .form-control:focus { border-color: #1abc9c; box-shadow: 0 0 0 0.25rem rgba(26, 188, 156, 0.25); }
    </style>
</head>
<body>

<div id="alertContainer" class="xd-container"></div>

<div class="card card-login bg-white">
    <div class="card-header">
        <i class="fa-solid fa-scale-balanced fa-3x mb-3"></i>
        <h4 class="fw-bold">HukukSis</h4>
        <p class="mb-0 text-white-50 small">Yönetim Paneli Girişi</p>
    </div>
    <div class="card-body p-4 pt-5">
        <form onsubmit="event.preventDefault(); login();">
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
                <label for="email"><i class="fa-solid fa-envelope me-2"></i>E-Posta Adresi</label>
            </div>
            <div class="form-floating mb-4">
                <input type="password" class="form-control" id="password" placeholder="Password" required>
                <label for="password"><i class="fa-solid fa-lock me-2"></i>Şifre</label>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-custom">Giriş Yap</button>
            </div>
        </form>
    </div>
    <div class="card-footer text-center py-3 bg-white border-0 text-muted small">
        <p class="mb-0">Hesabınız yok mu? <a href="#" class="text-decoration-none fw-bold text-success" data-bs-toggle="modal" data-bs-target="#registerModal">Hemen Kaydol</a></p>
    </div>
</div>

<div class="modal fade" id="registerModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 25px; border:none;">
            <div class="modal-header border-0 pt-4 justify-content-center">
                <div class="text-center">
                    <i class="fa-solid fa-user-plus fa-3x text-success mb-2"></i>
                    <h4 class="fw-bold">Yeni Hesap</h4>
                </div>
                <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body px-4 pb-4">
                <form id="registerForm">
                    <div class="row g-2 mb-2">
                        <div class="col-6"><div class="form-floating"><input type="text" class="form-control" id="regName" placeholder="Ad" required><label>Ad</label></div></div>
                        <div class="col-6"><div class="form-floating"><input type="text" class="form-control" id="regSurname" placeholder="Soyad" required><label>Soyad</label></div></div>
                    </div>
                    <div class="form-floating mb-2"><input type="email" class="form-control" id="regMail" placeholder="Mail" required><label>E-Posta</label></div>
                    <div class="form-floating mb-1"><input type="password" class="form-control" id="regPassword" placeholder="Şifre" required><label>Şifre</label></div>
                    <small class="text-muted"><i class="fa-solid fa-info-circle me-1"></i>En az 4 karakter, büyük/küçük harf, rakam ve sembol.</small>
                </form>
            </div>
            <div class="modal-footer border-0 justify-content-center pb-4">
                <button type="button" class="btn btn-custom w-75" onclick="register()">Ücretsiz Kaydol</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API = {
        LOGIN: "http://localhost:8080/rest/api/user/login",
        REGISTER: "http://localhost:8080/rest/api/user/save"
    };

    /**
     * SENİN GÖNDERDİĞİN TASARIMI KULLANAN FONKSİYON
     * type: 'success', 'danger', 'warning'
     */
    function showCustomAlert(type, message) {
        const container = document.getElementById('alertContainer');
        
        // İkon ve Class Belirleme
        let iconClass = 'fa-circle-info';
        let msgClass = ''; // Varsayılan (Mavi/Gri)
        
        if (type === 'success') {
            iconClass = 'fa-check';
            msgClass = 'msg-success';
        } else if (type === 'danger' || type === 'error') {
            iconClass = 'fa-xmark';
            msgClass = 'msg-danger';
        } else if (type === 'warning') {
            iconClass = 'fa-triangle-exclamation';
            msgClass = 'msg-warning';
        }

        // HTML Elementini Oluştur
        const alertDiv = document.createElement('div');
        alertDiv.className = `xd-message ${msgClass}`;
        alertDiv.innerHTML = `
            <div class="xd-message-icon">
                <i class="fa-solid ${iconClass}"></i>
            </div>
            <div class="xd-message-content">
                <p>${message}</p>
            </div>
            <a href="javascript:void(0)" class="xd-message-close" onclick="closeAlert(this)">
                <i class="fa-solid fa-xmark"></i>
            </a>
        `;

        container.appendChild(alertDiv);

        // 5 saniye sonra otomatik kapan
        setTimeout(() => {
            if(alertDiv) closeAlert(alertDiv.querySelector('.xd-message-close'));
        }, 5000);
    }

    function closeAlert(element) {
        const parent = element.closest('.xd-message');
        parent.classList.add('xd-hide');
        setTimeout(() => {
            parent.remove();
        }, 500); // Animasyon süresi kadar bekle
    }

    function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const payload = { mail: email, password: password };

        fetch(API.LOGIN, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(async response => {
            if (response.ok) return response.json();
            const errData = await response.json(); 
            throw new Error(errData.exception ? errData.exception.message : "Giriş başarısız");
        })
        .then(userData => {
            localStorage.setItem('user', JSON.stringify(userData));
            
            // YENİ TASARIMLI ALERT
            showCustomAlert('success', 'Giriş Başarılı! Yönlendiriliyorsunuz...');
            
            setTimeout(() => {
                window.location.href = "index.html";
            }, 1500);
        })
        .catch(error => {
            // YENİ TASARIMLI ALERT
            showCustomAlert('danger', error.message || 'E-posta veya şifre hatalı.');
        });
    }

    function register() {
        const name = document.getElementById('regName').value;
        const surname = document.getElementById('regSurname').value;
        const mail = document.getElementById('regMail').value;
        const password = document.getElementById('regPassword').value;

        const payload = { name: name, surname: surname, mail: mail, password: password };

        fetch(API.REGISTER, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(async response => {
            if (!response.ok) {
                const data = await response.json();
                let errorMsg = "Kayıt oluşturulamadı.";
                if (data && data.exception && data.exception.message) {
                    if (typeof data.exception.message === 'object') {
                        // Liste ise düz metne çevirip aralarına virgül koyalım ki popup düzgün görünsün
                        let list = Object.values(data.exception.message).flat();
                        errorMsg = list.join('<br>'); 
                    } else {
                        errorMsg = data.exception.message;
                    }
                }
                throw new Error(errorMsg);
            }
            return response.json();
        })
        .then(data => {
            bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
            document.getElementById('registerForm').reset();
            
            // YENİ TASARIMLI ALERT
            showCustomAlert('success', 'Hesap Oluşturuldu! Giriş yapabilirsiniz.');
        })
        .catch(error => {
            // YENİ TASARIMLI ALERT
            showCustomAlert('danger', error.message);
        });
    }
</script>
</body>
</html>